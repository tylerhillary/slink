rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    match /registrations/{registrationId} {
      allow create: if
        request.auth == null &&
        request.resource.data.keys().hasOnly([
          'fullName',
          'email',
          'age',
          'gender',
          'location',
          'selectedSkill',
          'status',
          'source',
          'consent',
          'createdAt'
        ]) &&
        request.resource.data.keys().hasAll([
          'fullName',
          'email',
          'age',
          'gender',
          'location',
          'selectedSkill',
          'consent',
          'createdAt'
        ]) &&
        request.resource.data.fullName is string && request.resource.data.fullName.size() >= 3 &&
        request.resource.data.email is string && request.resource.data.email.size() > 5 &&
        request.resource.data.age is int && request.resource.data.age >= 13 && request.resource.data.age <= 100 &&
        request.resource.data.gender is string && request.resource.data.gender.size() > 0 &&
        request.resource.data.location is string && request.resource.data.location.size() > 0 &&
        request.resource.data.selectedSkill is string && request.resource.data.selectedSkill.size() > 0 &&
        request.resource.data.consent == true &&
        request.resource.data.createdAt is timestamp &&
        request.resource.data.status in ['pending', 'matched', 'archived'] &&
        request.resource.data.source is string;

      allow read, update, delete: if false;
    }

    match /{document=**} {
      allow read, write: if request.auth != null && request.auth.token.admin == true;
    }
  }
}
